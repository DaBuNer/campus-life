<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>校园生活</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
          integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <script src="vue/js/vue.min.js"></script>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="vue/js/axios.min.js"></script>
</head>
<style>
    .input_border input {
        border: 0;
        text-align: center;
    }
</style>
<body>
<div id="root" class="container-fluid">
    <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-6">
            <div class="row">
                <nav class="navbar navbar-default">
                    <div class="container-fluid">
                        <div class="navbar-header">
                            <a class="navbar-brand" href="/index.html">校园生活</a>
                        </div>
                        <ul class="nav navbar-nav navbar-right">
                            <li class="dropdown">
                                <template>
                                    <el-row class="demo-avatar demo-basic">
                                        <div class="demo-basic--circle">
                                            <a href="userInfo/index.html">
                                                <div class="block">
                                                    <el-avatar :size="50" :src="head.imageUrl"></el-avatar>
                                                </div>
                                            </a>
                                        </div>
                                    </el-row>
                                </template>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="btn-group" role="group" style="width: 100%">
                        <button type="button" class="btn btn-default"
                                style="text-align: center;width: 100%; border: #FFFFFF solid 0;font-size: 20px">
                            <a href="/index.html" style="text-decoration: none; color: #ec971f;"><span
                                    class="glyphicon glyphicon-th-list"></span>&nbsp;&nbsp;&nbsp;&nbsp;全部关注</a>
                        </button>
                    </div>
                </div>
                <div class="col-md-9">
                    <div style="border: silver solid 1px;padding: 5px;border-radius: 3px">
                        <el-input
                                style="font-size: 15px; "
                                type="textarea"
                                placeholder="请输入内容"
                                v-model="textarea"
                                :rows="rows"
                                show-word-limit>
                        </el-input>
                        <br/>
                        <div style="display: flex; margin-top: 4px">
                            <div style="flex: 1;"></div>
                            <div style="flex: 1;"></div>
                            <div style="flex: 1;"></div>
                            <div style="flex: 1;"></div>
                            <div style="flex: 1;"></div>
                            <div style="flex: 1; ">
                                <template>
                                    <el-select class="input_border" v-model="value" style="width: 130px">
                                        <el-option
                                                v-for="item in options"
                                                :key="item.value"
                                                :label="item.label"
                                                :value="item.value">
                                        </el-option>
                                    </el-select>
                                </template>
                            </div>
                            <div style="flex: 1; text-align: right">
                                <el-row>
                                    <el-button style="font-size: 12px" type="warning" :disabled="read" round
                                               @click="onSubmit">发送
                                    </el-button>
                                </el-row>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3"></div>
    </div>
</div>

</body>
<script type="text/javascript">
    new Vue({
        el: '#root',
        data: {
            head: {
                imageUrl: 'image/head_image.png'
            },
            form: {
                personName: '',
                personAge: 0,
                personAddress: '',
                schoolName: ''
            },
            /*发表文本信息*/
            textarea: '',
            rows: 3,
            options: [{
                value: 1,
                label: '公开'
            }, {
                value: 2,
                label: '粉丝'
            }, {
                value: 4,
                label: '仅自己可见'
            }],
            value: 1,
            read: true
        },
        methods: {
            onSubmit() {
                let that = this
                axios({
                    method: 'post',
                    url: '/lifeMessage/addLifeMessage',
                    data: {
                        messageInfo: this.textarea,
                        power: this.value
                    }
                }).then(function (action) {
                    if (action.data.successful) {
                        that.$message({
                            type: 'success',
                            message: '新增成功'
                        });
                        that.textarea = ''
                    } else {
                        that.$message({
                            type: 'error',
                            message: action.data.message
                        });
                    }
                })
            },
        },
        watch: {
            textarea() {
                let length = this.textarea.length;
                this.read = length <= 0;
                if (length > 42 * 2) {
                    this.rows = (length / 42) + 2
                } else {
                    this.rows = 3
                }
            },
        },
        mounted() {
            let that = this
            axios({
                method: "post",
                url: "/user/getUserInfo"
            }).then(function (action) {
                that.form = action.data.data
            })

            axios({
                method: 'post',
                url: '/lifeMessage/listLifeMessage',
                data: {
                    pageIndex: 1,
                    pageSize: 6
                }
            })
        },
    })
</script>
</html>